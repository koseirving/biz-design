# Module 1: プロジェクトのセットアップと基盤構築
- [x] Task 1.1: GCPプロジェクトの初期化design.md#6.1の記述に基づき、gcloudコマンドを実行してGCPプロジェクトの作成、APIの有効化、サービスアカウントの作成を行う。
- [x] Task 1.2: Gitリポジトリとプロジェクト構造のセットアップ新規Gitリポジトリを作成する。リポジトリのルートにfrontendとbackendの2つのディレクトリを作成する。frontendディレクトリ内でnpx create-next-app@latestを実行し、Next.jsプロジェクトを初期化する。backendディレクトリ内でFastAPIプロジェクトの基本構造（main.py, requirements.txtなど）を作成する。
- [x] Task 1.3: "Hello World"アプリケーションの実装とDocker化frontendとbackendそれぞれで、簡単な"Hello World"レスポンスを返すエンドポイントを実装する。各サービス用のDockerfileを作成する。
- [x] Task 1.4: CI/CDパイプラインの初期検証基本的なcloudbuild.yamlを作成する。Gitリポジトリにプッシュし、Cloud Buildがトリガーされ、2つの"Hello World"アプリケーションがCloud Runサービスとしてデプロイされることを確認する。

# Module 2: データベースとユーザー認証
## 基本データベースセットアップ
- [ ] Task 2.1: データベースのプロビジョニングとスキーマ作成
  Cloud SQL for PostgreSQLインスタンスをプロビジョニングする。基本テーブル（users, business_frameworks, user_outputs, company_profiles, user_progress）を作成する。
- [ ] Task 2.2: 拡張テーブルの作成
  新機能用テーブルを追加作成する：
  - user_learning_sessions（学習セッション管理）
  - notification_preferences（通知設定）
  - notification_history（通知履歴）
  - output_versions（バージョン管理）
  - user_badges（バッジ管理）
- [ ] Task 2.3: Redisインフラストラクチャのセットアップ
  Cloud MemorystoreでRedisインスタンスをプロビジョニングする。通知キュー用（db=1）とセッションキャッシュ用（db=0）の設定を行う。

## 認証システム
- [ ] Task 2.4: バックエンド認証エンドポイントの実装
  FastAPIバックエンドに、/auth/registerおよび/auth/loginエンドポイントを実装する。パスワードのハッシュ化にはbcryptライブラリを使用する。
- [ ] Task 2.5: JWT生成とCookie設定ロジックの実装
  ログイン成功時に、アクセストークンとリフレッシュトークンを生成するロジックを実装する。生成したトークンをHttpOnly属性付きのCookieとしてレスポンスに設定する。
- [ ] Task 2.6: フロントエンド認証フォームの実装
  Next.jsフロントエンドに、新規登録フォームとログインフォームのUIコンポーネントを構築する。
- [ ] Task 2.7: Next.js BFFプロキシの実装
  認証関連のエンドポイント（/api/proxy/auth/...）をNext.js API Routesとして実装し、バックエンドへのリクエストを中継する。
- [ ] Task 2.8: クライアントサイドの認証状態管理
  React Context APIを使用して、ユーザーのログイン状態をグローバルに管理するAuthProviderを実装する。

## データプライバシー機能
- [ ] Task 2.9: ユーザーデータエクスポート機能の実装
  /users/data-exportエンドポイントを実装する。ユーザーの全データ（プロファイル、学習履歴、アウトプット、進捗）をJSON/CSV形式で生成し、7日間有効なダウンロードURLを返す。
- [ ] Task 2.10: GDPRアカウント削除機能の実装
  /users/deleteエンドポイントを実装する。段階的削除プロセス（ソフトデリート→匿名化→物理削除）をCloud Tasksでスケジューリングする。
- [ ] Task 2.11: 通知設定管理APIの実装
  /users/preferencesエンドポイントを実装する。メール通知、プッシュ通知、リマインダー設定のCRUD操作を提供する。

# Module 3: コアコンテンツとバージョン管理
## フレームワークコンテンツ管理
- [ ] Task 3.1: バックエンドでのフレームワークコンテンツ管理
  バックエンドに/frameworksエンドポイントを実装する。business_frameworksテーブルに、SWOT分析とユーザージャーニーマップの初期データを投入する。
- [ ] Task 3.2: フロントエンドでのコンテンツ表示
  フロントエンドに、フレームワーク一覧ページと、各フレームワークのマイクロコンテンツを表示するページを構築する。これはフリープランの主要機能となる。
- [ ] Task 3.3: プレミアム機能のアクセス制御
  バックエンドに、JWTペイロード内のsubscription_tierを検証するミドルウェア（またはDepends）を実装する。プレミアム限定のエンドポイント（例: /ai/interact）に対して、フリープランのユーザーからのアクセスがあった場合に403 Forbiddenエラーを返すようにする。

## アウトプットバージョン管理システム
- [ ] Task 3.4: バージョン管理API基盤の実装
  アウトプットのバージョン管理機能を実装する。POST /outputs/{output_id}/versionsで新バージョン作成、GET /outputs/{output_id}/versionsでバージョン履歴取得、GET /outputs/{output_id}/versions/{version_id}で特定バージョン取得のエンドポイントを作成する。
- [ ] Task 3.5: 自動保存機能の実装
  30秒ごとの自動保存機能を実装する。フロントエンドでsetIntervalを使用してドラフトを自動保存し、バックエンドで/outputs/{output_id}/auto-saveエンドポイントを作成する。
- [ ] Task 3.6: バージョン差分表示機能の実装
  バージョン間の差分を表示する機能を実装する。GET /outputs/{output_id}/versions/{version1_id}/diff/{version2_id}エンドポイントで差分データを返し、フロントエンドで視覚的にハイライト表示する。
- [ ] Task 3.7: バージョン復元機能の実装
  任意のバージョンへの復元機能を実装する。POST /outputs/{output_id}/versions/{version_id}/restoreエンドポイントを作成し、指定バージョンを現在バージョンとして復元する。

## 学習セッション追跡システム
- [ ] Task 3.8: 学習セッション管理APIの実装
  user_learning_sessionsテーブルを活用した学習セッション管理機能を実装する。POST /learning-sessions/startでセッション開始、PUT /learning-sessions/{session_id}/progressで進捗更新、POST /learning-sessions/{session_id}/completeでセッション完了のエンドポイントを作成する。
- [ ] Task 3.9: セッション分析機能の実装
  学習セッションの分析機能を実装する。GET /users/me/learning-analyticsで学習時間、完了率、苦手分野などの統計情報を返すエンドポイントを作成する。

# Module 4: AIコパイロット (Gemini連携)
- [ ] Task 4.1: バックエンドに分析サービスモジュールを作成バックエンドにservices/swot_analyzer.pyのようなサービスモジュールを作成し、SWOT分析に関連するビジネスロジックをカプセル化する。
- [ ] Task 4.2: Gemini Function Declarationの定義バックエンドコード内に、design.md#4.2のテーブルで定義されたanalyze_swotのFunction Declarationを定義する。
- [ ] Task 4.3: メインのAI対話エンドポイントの実装/ai/interactエンドポイントを実装する。このエンドポイントは以下の処理を行う:a.  クライアントから会話履歴と最新のユーザー入力を受け取る。b.  プロンプトと関連するFunction Declarationを付けてGemini APIを呼び出す。c.  モデルがFunction Callを返してきた場合、対応するサービスモジュールを実行する。d.  関数の実行結果を次のAPIコールでモデルに返し、最終的なテキスト応答を得る。e.  最終的なテキスト応答をクライアントにストリーミングで返す。
- [ ] Task 4.4: フロントエンドのAI対話UIの実装フロントエンドにAiInteractionPanelコンポーネントを構築する。これはユーザーがAIと対話するためのチャット形式のインターフェースとなる。
- [ ] Task 4.5: アウトプット可視化コンポーネントの実装完了したSWOT分析のoutput_dataを、design.mdで指定された2x2のグリッド形式で表示するSwotOutputDisplayコンポーネントを構築する。

# Module 5: プレミアム機能とゲーミフィケーション
## 自社・競合プロファイル機能
- [ ] Task 5.1: 企業プロファイルCRUD APIの実装
  CompanyProfilesを管理するためのCRUD APIを実装する。POST /company-profiles（作成）、GET /company-profiles（一覧取得）、PUT /company-profiles/{id}（更新）、DELETE /company-profiles/{id}（削除）のエンドポイントを作成する。
- [ ] Task 5.2: 企業プロファイル管理UIの実装
  フロントエンドに企業プロファイル管理ページを実装する。自社・競合他社の情報入力フォーム、一覧表示、編集・削除機能を実装する。

## ポイントシステムとバッジ機能
- [ ] Task 5.3: ポイント付与システムの実装
  バックエンドにポイント付与ロジックを実装する。コンテンツ視聴（10pt）、フレームワーク学習（50pt）、AI対話開始（20pt）、アウトプット生成（100pt）などのルールを実装する。
- [ ] Task 5.4: バッジ管理システムの実装
  user_badgesテーブルを活用したバッジ管理システムを実装する。初心者バッジ、探究者バッジ、専門家バッジ、継続者バッジの獲得条件を判定し、バッジを付与するロジックを実装する。
- [ ] Task 5.5: 連続ログイン記録システムの実装
  ユーザーのログイン履歴を追跡し、連続ログイン日数に応じたポイント付与（日数×5pt、最大30日）と継続者バッジの獲得機能を実装する。
- [ ] Task 5.6: AI評価システムの実装
  アウトプットのAI評価機能を実装する。Gemini APIを使用してアウトプットの品質を評価（100点満点）し、80点以上の高品質アウトプットにボーナス50ptを付与する機能を実装する。

## ゲーミフィケーションダッシュボード
- [ ] Task 5.7: 進捗データ集計APIの実装
  ユーザーの集計済み進捗データを返す/users/me/progressエンドポイントを実装する。総ポイント、獲得バッジ一覧、完了フレームワーク数、アウトプット作成数などを返す。
- [ ] Task 5.8: フロントエンドダッシュボードの実装
  進捗データを視覚化するユーザーダッシュボードコンポーネントを実装する。ポイントグラフ、バッジギャラリー、学習進捗率、達成統計などを表示する。

# Module 7: 通知システムとエビングハウス復習機能
## 通知システムインフラ構築
- [ ] Task 7.1: 通知キューシステムの構築
  Redisベースの通知キューシステムを構築する。種類別キュー（email_queue, push_queue, reminder_queue）を作成し、優先度や遅延送信に対応する。
- [ ] Task 7.2: 通知サービスアーキテクチャの実装
  バックエンドにNotificationServiceクラスを実装する。email, push, in-appの3種類の通知方法に対応し、Cloud Schedulerと連携したスケジュール管理機能を実装する。
- [ ] Task 7.3: 通知設定管理APIの実装
  ユーザーの通知設定を管理するCRUD APIを実装する。notification_preferencesテーブルを活用し、メール、プッシュ、リマインダーのオンオフ設定を管理する。

## エビングハウス復習システム
- [ ] Task 7.4: 復習スケジューラーの実装
  学習完了からの経過日数（1日、3日、7日、30日）に基づいた復習リマインダーをCloud Schedulerで自動送信する機能を実装する。
- [ ] Task 7.5: 復習コンテンツ生成機能の実装
  復習用クイズ（5問程度）、キーポイントサマリー、アウトプット振り返り、AIよる応用問題の4種類の復習コンテンツを動的生成する機能を実装する。
- [ ] Task 7.6: 復習進捗追跡機能の実装
  復習完了率、理解度チェック結果、継続率などの指標を記録する機能を実装する。学習効果の可視化と復習スケジュールの最適化に活用する。

## 通知配信機能
- [ ] Task 7.7: メール通知システムの実装
  SendGridまたはGmail APIを使用したメール通知機能を実装する。テンプレートエンジンを使用して、復習リマインダー、達成通知、サブスクリプション通知のメールを生成し送信する。
- [ ] Task 7.8: アプリ内通知機能の実装
  フロントエンドにリアルタイムのアプリ内通知機能を実装する。WebSocketまたはServer-Sent Eventsを使用し、ダッシュボードの通知パネルにリアルタイムで通知を表示する。

# Module 8: フロントエンド新規コンポーネント
## バージョン管理関連UI
- [ ] Task 8.1: バージョン履歴コンポーネントの実装
  アウトプットのバージョン履歴を表示するVersionHistoryPanelコンポーネントを実装する。タイムスタンプ付きのバージョン一覧、プレビュー、復元ボタンを含む。
- [ ] Task 8.2: バージョン差分表示UIの実装
  バージョン間の差分を視覚的に表示するDiffViewerコンポーネントを実装する。追加、削除、変更されたテキストを異なる色でハイライト表示する。

## ゲーミフィケーションUI
- [ ] Task 8.3: バッジコレクションコンポーネントの実装
  獲得バッジをギャラリー形式で表示するBadgeCollectionコンポーネントを実装する。獲得済みバッジのアニメーション表示、未獲得バッジの獲得条件表示機能を含む。
- [ ] Task 8.4: ポイントグラフコンポーネントの実装
  ユーザーのポイント獲得履歴をグラフ表示するPointsChartコンポーネントを実装する。Chart.jsまたはRechartsを使用し、日別・週別・月別のポイント獲得推移を表示する。

## 通知系コンポーネント
- [ ] Task 8.5: 通知センターコンポーネントの実装
  アプリ内通知を管理するNotificationCenterコンポーネントを実装する。未読通知カウント、通知一覧、既読マーク機能、通知の種類別フィルタリング機能を含む。
- [ ] Task 8.6: 復習リマインダーモーダルの実装
  エビングハウス復習のリマインダーを表示するReviewReminderModalコンポーネントを実装する。復習コンテンツの表示、進捗バー、スキップ・完了ボタンを含む。

## アウトプット関連拡張UI
- [ ] Task 8.7: アウトプットエクスポート機能の実装
  アウトプットをPDF、PNG、CSV形式でエクスポートする機能を実装する。jsPDF、html2canvas、papaparseなどのライブラリを活用し、ユーザーが形式を選択してダウンロードできるようにする。
- [ ] Task 8.8: アウトプットテンプレートシステムの実装
  ユーザーがアウトプットのデザインテンプレートを選択できる機能を実装する。ビジネスフォーマル、カジュアル、プレゼンテーション用などのテンプレートを用意する。

# Module 9: セキュリティとプライバシー
## データプライバシーコンプライアンス
- [ ] Task 9.1: GDPRコンプライアンスモジュールの実装
  GDPRに準拠したデータ処理モジュールを実装する。データ処理の同意取得、オプトアウト機能、個人データの最小限収集ポリシーを適用する。
- [ ] Task 9.2: データエクスポートAPIの実装
  ユーザーの全データをJSON/CSV形式でエクスポートする/users/data-exportエンドポイントを実装する。ユーザープロファイル、学習履歴、アウトプット、進捗データを包含し、7日間有効なダウンロードURLを生成する。
- [ ] Task 9.3: アカウント削除機能の実装
  GDPRに対応したアカウント削除機能を実装する。段階的削除プロセス（ソフトデリート→匿名化→物理削除）をCloud Tasksでスケジューリングし、30日以内に完全削除する。

## セキュリティ強化
- [ ] Task 9.4: APIレート制限の実装
  フリー/プレミアムプラン別のAPIレート制限を実装する。Redisを使用したスライディングウィンドウレートリミッターを実装し、429ステータスとRetry-Afterヘッダーで適切にレスポンスする。
- [ ] Task 9.5: データ暗号化機能の実装
  保存時（AES-256）および転送時（TLS 1.3）のデータ暗号化を実装する。機密情報（パスワード、APIキー）はGCP Secret Managerで管理し、アプリケーションレベルでは一切ハードコードしない。

## 監査ログとモニタリング
- [ ] Task 9.6: セキュリティ監査ログの実装
  データアクセスの監査証跡を180日間保持する機能を実装する。ユーザーデータへのアクセス、変更、削除操作を全てログ記録し、Google Cloud Loggingで集中管理する。
- [ ] Task 9.7: アクセシビリティ対応の実装
  WCAG 2.1 Level AAに準拠したアクセシビリティ機能を実装する。キーボードナビゲーション、スクリーンリーダー対応、色のコントラスト最適化などを実装し、障害を持つユーザーも利用できるようにする。

# Module 10: 最終化とデプロイメント
## 本番環境構築
- [ ] Task 10.1: 本番用CI/CDパイプラインの整備
  cloudbuild.yamlを本番デプロイ用に改良する。GCP Secret Managerを利用してAPIキーやデータベースパスワードなどの秘匿情報を安全に扱う。環境別（dev/staging/prod）のデプロイメントフローを設定する。
- [ ] Task 10.2: 構造化ログギングの実装
  フロントエンド（BFF）とバックエンドの両サービスに、Google Cloud Loggingでの監視を容易にするための構造化ログギング（JSON形式）を導入する。ログレベル、タイムスタンプ、ユーザーID、リクエストIDなどの統一フィールドを設定する。
- [ ] Task 10.3: 監視とアラートの設定
  GCPコンソールで、予算アラートや主要メトリクス（レイテンシ、エラーレート）のモニタリングダッシュボードを設定する。Cloud Runのメモリ・CPU使用率、Cloud SQLのコネクション数、Redisのメモリ使用率などを監視し、閾値超過時にアラートを送信する。

## 品質保証とテスト
- [ ] Task 10.4: E2Eテストスイートの実装
  requirement.mdに記載された主要なユーザーストーリーに基づき、PlaywrightまたはCypressを使用したE2Eテストを実装する。ユーザー登録からSWOT分析完了までのフロー、フリーミアムアップグレードフローをカバーする。
- [ ] Task 10.5: パフォーマンステストの実装
  LighthouseやK6を使用したパフォーマンステストを実装する。APIレスポンスタイム500ms以下、初期ロード3秒以内、ページ遷移1秒以内のパフォーマンス目標を達成できているか検証する。

## 最終デプロイとローンチ
- [ ] Task 10.6: プロダクションデプロイメント
  ステージング環境での最終テスト後、本番環境への最終デプロイを実行する。データベースマイグレーション、シードデータの投入、Cloud Runサービスの起動、DNS設定を順次実行し、全機能が正常動作することを確認する。
- [ ] Task 10.7: ローンチ準備とユーザーテスト
  ベータユーザーを招待してユーザビリティテストを実施する。ターゲットペルソナに近いユーザー10-15名に実際にサービスを使用してもらい、フィードバックを収集して最終調整を実施する。

